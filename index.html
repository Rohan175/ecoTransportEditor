<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Eco Transport</title>
  <link rel="stylesheet" href="dist/css/grapes.min.css">
  <script src="dist/grapes.js"></script>
  <script src="./node_modules/grapesjs-blocks-basic/dist/grapesjs-blocks-basic.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body,
    html {
      height: 100%;
      margin: 0;
    }
  </style>
</head>

<body>
  <div id="gjs" style="height:0; overflow:hidden;">

  </div>

  <script type="text/javascript">
    var editor = grapesjs.init({
      showOffsets: 1,
      noticeOnUnload: 0,
      container: '#gjs',
      height: '100%',
      fromElement: true,
      plugins: ["gjs-blocks-basic"],
      pluginsOpts: {
        "gjs-blocks-basic": {
          blocks: ['column1', 'column2', 'column3', 'column3-7', 'image', 'text']//, 'link', 'video', 'map']
        }
      },
      domComponents: {
        // wrapper: {
        //   components: [
        //     `<div style="height: 300px"></div>`
        //   ]
        // }
      },
      storageManager: { autoload: 0 },
      deviceManager: {
        devices: [ { "name": "Desktop ", "width": "1200px"} ]
      },
      styleManager: {
        sectors: [{
          name: 'General',
          open: false,
          buildProps: ['float', 'display', 'text-align', 'position', 'top', 'right', 'left', 'bottom']
        }, {
          name: 'Flex',
          open: false,
          buildProps: ['flex-direction', 'flex-wrap', 'justify-content', 'align-items', 'align-content', 'order', 'flex-basis', 'flex-grow', 'flex-shrink', 'align-self']
        }, {
          name: 'Dimension',
          open: false,
          buildProps: ['width', 'height', 'max-width', 'min-height', 'margin', 'padding'],
        }, {
          name: 'Typography',
          open: false,
          buildProps: ['font-family', 'font-size', 'font-weight', 'letter-spacing', 'color', 'line-height', 'text-shadow'],
        }, {
          name: 'Decorations',
          open: false,
          buildProps: ['border-radius-c', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
        }, {
          name: 'Extra',
          open: false,
          buildProps: ['transition', 'perspective', 'transform'],
        }
        ],
      },
    });

    const domComponents = editor.DomComponents;
    domComponents.getWrapper().set('style', { 'height':'100%',  });
    const commands = editor.Commands;
    
    commands.add('exportpng', {
      run(editor, sender) {
        html2canvas(document.querySelector("iFrame").contentDocument.body).then(canvas => {
          const link = document.createElement('a');
          link.setAttribute('download', 'banner.png');
          link.setAttribute('href', canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"));
          link.click();
        })
      },
    });
  </script>
</body>

</html>